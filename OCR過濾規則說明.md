# OCR 過濾規則說明

## 問題描述

植物花牌照片中包含 LOGO，LOGO 中有「童話花園」的文字。OCR 識別時會識別到這些文字，導致解析結果錯誤。

## 解決方案

已實現多層過濾機制，徹底排除「童話」和「花園」相關的文字：

### 1. 預先過濾（第一層）

在提取 OCR 識別結果時，如果識別到的文字只是過濾詞，直接跳過，不加入文本列表。

過濾詞列表：
- `童話`
- `花園`
- `花圈`（OCR誤識別"花園"的變體）
- `花圜`（OCR誤識別"花園"的變體）
- `童話花園`、`花園童話`
- `童話花圈`、`花圈童話`（OCR誤識別的組合）
- `童話花圜`、`花圜童話`（OCR誤識別的組合）
- `QR`, `qr`, `code`（QR碼相關）

### 2. 解析時過濾（第二層）

在解析植物信息時，進一步過濾：

- **完全匹配過濾**：如果文本完全匹配過濾詞，跳過
- **組合過濾**：如果文本是「童話花園」的組合，跳過
- **單字過濾**：如果文本只是一個字（如「童」或「花」），跳過
- **前後綴過濾**：移除文本開頭和結尾的過濾詞
- **中間過濾**：移除文本中間的「童話花園」組合

### 3. 最終檢查

在確定為植物名稱前，檢查：
- 過濾後的文本是否只包含過濾詞
- 過濾後的文本是否過短（≤3個字符）且包含過濾詞

## 過濾邏輯示例

### 會被過濾掉的文字

- `童話` → 跳過
- `花園` → 跳過
- `花圈` → 跳過（OCR誤識別"花園"）
- `花圜` → 跳過（OCR誤識別"花園"）
- `童話花園` → 跳過
- `花園童話` → 跳過
- `童話花圈` → 跳過（OCR誤識別）
- `花圈童話` → 跳過（OCR誤識別）
- `童話花圜` → 跳過（OCR誤識別）
- `花圜童話` → 跳過（OCR誤識別）
- `童話 花園` → 跳過
- `童話 花圈` → 跳過（OCR誤識別）
- `童話 花圜` → 跳過（OCR誤識別）
- `QR` → 跳過

### 會被保留的文字

- `火鶴王花燭` → 保留（是植物名稱）
- `黃金葛` → 保留（是植物名稱）
- `童話花園 火鶴王花燭` → 過濾後：`火鶴王花燭`（保留）
- `火鶴王花燭 童話花園` → 過濾後：`火鶴王花燭`（保留）

## 技術實現

### 代碼位置

- `plant_diary/ocr_reader.py` - `_parse_plant_info` 方法
- `plant_diary/ocr_reader.py` - `_recognize_with_easyocr` 方法

### 過濾流程

1. **文本提取階段**：排除完全匹配的過濾詞
2. **文本解析階段**：多層過濾，確保不會誤判

## 使用建議

### 如果仍然識別到「花園」

1. **檢查原始文本**：查看 OCR 識別到的原始文本，確認是否有其他格式的「花園」文字
2. **手動輸入**：如果自動識別不準確，可以從原始文本中手動提取植物名稱
3. **照片角度**：嘗試調整拍照角度，盡量不讓 LOGO 出現在照片中

### 改進建議

如果發現特定格式的文字仍被誤識別，可以：
1. 記錄該文字的格式
2. 將格式添加到過濾詞列表
3. 或者調整過濾邏輯

## 更新日誌

### v1.4.0
- 添加「花圜」到過濾詞列表（OCR誤識別「花園」的變體）

### v1.3.0
- 添加「花圈」到過濾詞列表（OCR誤識別「花園」的變體）
- 改進過濾邏輯，處理OCR誤識別的情況

### v1.2.0
- 改進過濾邏輯，徹底排除「童話」和「花園」相關文字
- 添加預先過濾機制
- 多層過濾確保準確性

